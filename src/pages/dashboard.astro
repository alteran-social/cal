---
import Layout from '../layouts/Layout.astro';
import { getSession } from '../lib/auth/session';

const session = await getSession(Astro.request);

if (!session) {
  return Astro.redirect('/auth/login');
}
---

<Layout title="Dashboard - atproto Cal">
  <main style="max-width: 1200px; margin: 0 auto; padding: 2rem;">
    <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
      <div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Dashboard</h1>
        <p style="color: #666;">Welcome back, {session.handle}</p>
      </div>
      <div style="display: flex; gap: 1rem;">
        <a href="/settings" style="padding: 0.5rem 1rem; border: 1px solid #ddd; border-radius: 4px; text-decoration: none; color: #333;">
          Settings
        </a>
        <form method="POST" action="/api/auth/logout" style="margin: 0;">
          <button type="submit" style="padding: 0.5rem 1rem; border: 1px solid #ddd; border-radius: 4px; background: white; color: #333;">
            Sign Out
          </button>
        </form>
      </div>
    </header>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 3rem;">
      <div style="background: white; border-radius: 8px; padding: 1.5rem; border: 1px solid #e0e0e0;">
        <h3 style="margin-bottom: 1rem; color: #0066cc;">Your Booking Page</h3>
        <p style="margin-bottom: 1rem; color: #666; font-size: 0.9rem;">
          Share this link with others to let them book time with you
        </p>
        <a href={`/book/${session.handle}`} style="color: #0066cc; word-break: break-all;">
          {Astro.url.origin}/book/{session.handle}
        </a>
      </div>

      <div style="background: white; border-radius: 8px; padding: 1.5rem; border: 1px solid #e0e0e0;">
        <h3 style="margin-bottom: 1rem; color: #0066cc;">Quick Stats</h3>
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
          <div style="display: flex; justify-content: space-between;">
            <span style="color: #666;">Pending bookings:</span>
            <strong>0</strong>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span style="color: #666;">Confirmed bookings:</span>
            <strong>0</strong>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span style="color: #666;">Availability slots:</span>
            <strong>0</strong>
          </div>
        </div>
      </div>
    </div>

    <section style="background: white; border-radius: 8px; padding: 2rem; margin-bottom: 2rem;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="font-size: 1.5rem;">Your Availability</h2>
        <a href="/availability/new" style="background: #0066cc; color: white; padding: 0.75rem 1.5rem; border-radius: 4px; text-decoration: none;">
          + Add Availability
        </a>
      </div>

      <div style="text-align: center; padding: 3rem; color: #666;">
        <p>No availability slots configured yet.</p>
        <p style="margin-top: 0.5rem;">Create your first availability slot to let others book time with you.</p>
      </div>
    </section>

    <section style="background: white; border-radius: 8px; padding: 2rem;">
      <h2 style="font-size: 1.5rem; margin-bottom: 1.5rem;">Recent Bookings</h2>
      
      <div style="text-align: center; padding: 3rem; color: #666;">
        <p>No bookings yet.</p>
      </div>
    </section>
  </main>
</Layout>
